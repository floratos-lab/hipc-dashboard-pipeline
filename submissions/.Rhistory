}
}
}
head(final_list, 100)
uniqIDs <- unique(df2$uniq_obs_id)
# way too big!
final_list <- vector(mode = "list", length = length(uniqIDs)*(length(uniqIDs) - 1)/2)
cnt <- 1
for(pmid in pmids[1:20]) {
rows_for_pmid <- unique(df2$uniq_obs_id[df2$publication_reference == pmid])
for(i in 1:length(rows_for_pmid)) {
rco_i <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[i]]
for(j in min(i + 1, length(rows_for_pmid)):length(rows_for_pmid)) {
if(i == j) {
next
}
rco_j <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[j]]
answer <- intersect(rco_i, rco_j)
overlap_longer_fraction <- length(answer)/max(length(rco_i), length(rco_j))
overlap_shorter_fraction <- length(answer)/min(length(rco_i), length(rco_j))
if(length(answer) == 0) {
next
}
if(overlap_shorter_fraction < 0.4) {
next
}
if(length(answer) < 400) {
next
}
final_list[[cnt]] <- data.frame(pmid = pmid_tmp,
row1 = rows_for_pmid[i],
row2 = rows_for_pmid[j],
overlap_length = length(answer),
set1_count = length(rco_i),
set2_count = length(rco_j),
overlap_longer_fraction = overlap_longer_fraction,
overlap_shorter_fraction = overlap_shorter_fraction
)
cnt <- cnt + 1
}
}
}
head(final_list, 10)
uniqIDs <- unique(df2$uniq_obs_id)
# way too big!
final_list <- vector(mode = "list", length = length(uniqIDs)*(length(uniqIDs) - 1)/2)
cnt <- 1
for(pmid in pmids) {
rows_for_pmid <- unique(df2$uniq_obs_id[df2$publication_reference == pmid])
for(i in 1:length(rows_for_pmid)) {
rco_i <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[i]]
for(j in min(i + 1, length(rows_for_pmid)):length(rows_for_pmid)) {
if(i == j) {
next
}
rco_j <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[j]]
answer <- intersect(rco_i, rco_j)
overlap_longer_fraction <- length(answer)/max(length(rco_i), length(rco_j))
overlap_shorter_fraction <- length(answer)/min(length(rco_i), length(rco_j))
if(length(answer) == 0) {
next
}
if(overlap_shorter_fraction < 0.4) {
next
}
if(length(answer) < 400) {
next
}
final_list[[cnt]] <- data.frame(pmid = pmid_tmp,
row1 = rows_for_pmid[i],
row2 = rows_for_pmid[j],
overlap_length = length(answer),
set1_count = length(rco_i),
set2_count = length(rco_j),
overlap_longer_fraction = overlap_longer_fraction,
overlap_shorter_fraction = overlap_shorter_fraction
)
cnt <- cnt + 1
}
}
}
head(final_list, 10)
uniqIDs <- unique(df2$uniq_obs_id)
# way too big!
final_list <- vector(mode = "list", length = length(uniqIDs)*(length(uniqIDs) - 1)/2)
cnt <- 1
for(pmid in pmids) {
rows_for_pmid <- unique(df2$uniq_obs_id[df2$publication_reference == pmid])
for(i in 1:length(rows_for_pmid)) {
rco_i <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[i]]
rb_i <- df2$response_behavior[df2$uniq_obs_id == rows_for_pmid[i]][1]
for(j in min(i + 1, length(rows_for_pmid)):length(rows_for_pmid)) {
if(i == j) {
next
}
rco_j <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[j]]
rb_j <- df2$response_behavior[df2$uniq_obs_id == rows_for_pmid[j]][1]
inter_set <- intersect(rco_i, rco_j)
overlap_longer_fraction <- length(inter_set)/max(length(rco_i), length(rco_j))
overlap_shorter_fraction <- length(inter_set)/min(length(rco_i), length(rco_j))
if(length(inter_set) == 0) {
next
}
if(overlap_shorter_fraction < 0.4) {
next
}
if(length(inter_set) < 400) {
next
}
final_list[[cnt]] <- data.frame(pmid = pmid_tmp,
row1 = rows_for_pmid[i],
row2 = rows_for_pmid[j],
overlap_length = length(inter_set),
set1_count = length(rco_i),
set2_count = length(rco_j),
overlap_longer_fraction = overlap_longer_fraction,
overlap_shorter_fraction = overlap_shorter_fraction,
set1_resp_behav = rb_i,
set2_resp_behav = rb_j
)
cnt <- cnt + 1
}
}
}
head(final_list, 10)
final_list <- vector(mode = "list", length = length(uniqIDs)*(length(uniqIDs) - 1)/2)
cnt <- 1
for(pmid in pmids) {
rows_for_pmid <- unique(df2$uniq_obs_id[df2$publication_reference == pmid])
for(i in 1:length(rows_for_pmid)) {
rco_i <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[i]]
rb_i <- df2$response_behavior[df2$uniq_obs_id == rows_for_pmid[i]][1]
for(j in min(i + 1, length(rows_for_pmid)):length(rows_for_pmid)) {
if(i == j) {
next
}
rco_j <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[j]]
rb_j <- df2$response_behavior[df2$uniq_obs_id == rows_for_pmid[j]][1]
inter_set <- intersect(rco_i, rco_j)
overlap_longer_fraction <- length(inter_set)/max(length(rco_i), length(rco_j))
overlap_shorter_fraction <- length(inter_set)/min(length(rco_i), length(rco_j))
if(length(inter_set) == 0) {
next
}
if(overlap_shorter_fraction < 0.4) {
next
}
if(length(inter_set) < 400) {
next
}
if(rb_i == rb_j) {
next
}
final_list[[cnt]] <- data.frame(pmid = pmid_tmp,
row1 = rows_for_pmid[i],
row2 = rows_for_pmid[j],
overlap_length = length(inter_set),
set1_count = length(rco_i),
set2_count = length(rco_j),
overlap_longer_fraction = overlap_longer_fraction,
overlap_shorter_fraction = overlap_shorter_fraction,
set1_resp_behav = rb_i,
set2_resp_behav = rb_j
)
cnt <- cnt + 1
}
}
}
head(final_list, 10)
uniqIDs <- unique(df2$uniq_obs_id)
# way too big!
final_list <- vector(mode = "list", length = length(uniqIDs)*(length(uniqIDs) - 1)/2)
cnt <- 1
for(pmid in pmids) {
rows_for_pmid <- unique(df2$uniq_obs_id[df2$publication_reference == pmid])
for(i in 1:length(rows_for_pmid)) {
rco_i <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[i]]
rb_i <- df2$response_behavior[df2$uniq_obs_id == rows_for_pmid[i]][1]
for(j in min(i + 1, length(rows_for_pmid)):length(rows_for_pmid)) {
if(i == j) {
next
}
rco_j <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[j]]
rb_j <- df2$response_behavior[df2$uniq_obs_id == rows_for_pmid[j]][1]
inter_set <- intersect(rco_i, rco_j)
overlap_longer_fraction <- length(inter_set)/max(length(rco_i), length(rco_j))
overlap_shorter_fraction <- length(inter_set)/min(length(rco_i), length(rco_j))
if(length(inter_set) == 0) {
next
}
if(overlap_shorter_fraction < 0.4) {
next
}
if(length(inter_set) < 200) {
next
}
if(rb_i == rb_j) {
next
}
final_list[[cnt]] <- data.frame(pmid = pmid_tmp,
row1 = rows_for_pmid[i],
row2 = rows_for_pmid[j],
overlap_length = length(inter_set),
set1_count = length(rco_i),
set2_count = length(rco_j),
overlap_longer_fraction = overlap_longer_fraction,
overlap_shorter_fraction = overlap_shorter_fraction,
set1_resp_behav = rb_i,
set2_resp_behav = rb_j
)
cnt <- cnt + 1
}
}
}
head(final_list, 10)
head(final_list, 10)
uniqIDs <- unique(df2$uniq_obs_id)
# way too big!
final_list <- vector(mode = "list", length = length(uniqIDs)*(length(uniqIDs) - 1)/2)
cnt <- 1
for(pmid in pmids) {
rows_for_pmid <- unique(df2$uniq_obs_id[df2$publication_reference == pmid])
for(i in 1:length(rows_for_pmid)) {
rco_i <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[i]]
rb_i <- df2$response_behavior[df2$uniq_obs_id == rows_for_pmid[i]][1]
for(j in min(i + 1, length(rows_for_pmid)):length(rows_for_pmid)) {
if(i == j) {
next
}
rco_j <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[j]]
rb_j <- df2$response_behavior[df2$uniq_obs_id == rows_for_pmid[j]][1]
inter_set <- intersect(rco_i, rco_j)
overlap_longer_fraction <- length(inter_set)/max(length(rco_i), length(rco_j))
overlap_shorter_fraction <- length(inter_set)/min(length(rco_i), length(rco_j))
if(length(inter_set) == 0) {
next
}
if(overlap_shorter_fraction < 0.75) {
next
}
if(length(inter_set) < 200) {
next
}
if(rb_i == rb_j) {
next
}
final_list[[cnt]] <- data.frame(pmid = pmid_tmp,
row1 = rows_for_pmid[i],
row2 = rows_for_pmid[j],
overlap_length = length(inter_set),
set1_count = length(rco_i),
set2_count = length(rco_j),
overlap_longer_fraction = overlap_longer_fraction,
overlap_shorter_fraction = overlap_shorter_fraction,
set1_resp_behav = rb_i,
set2_resp_behav = rb_j
)
cnt <- cnt + 1
}
}
}
head(final_list, 10)
uniqIDs <- unique(df2$uniq_obs_id)
# way too big!
final_list <- vector(mode = "list", length = length(uniqIDs)*(length(uniqIDs) - 1)/2)
cnt <- 1
for(pmid in pmids) {
rows_for_pmid <- unique(df2$uniq_obs_id[df2$publication_reference == pmid])
for(i in 1:length(rows_for_pmid)) {
rco_i <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[i]]
rb_i <- df2$response_behavior[df2$uniq_obs_id == rows_for_pmid[i]][1]
for(j in min(i + 1, length(rows_for_pmid)):length(rows_for_pmid)) {
if(i == j) {
next
}
rco_j <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[j]]
rb_j <- df2$response_behavior[df2$uniq_obs_id == rows_for_pmid[j]][1]
inter_set <- intersect(rco_i, rco_j)
overlap_longer_fraction <- length(inter_set)/max(length(rco_i), length(rco_j))
overlap_shorter_fraction <- length(inter_set)/min(length(rco_i), length(rco_j))
if(length(inter_set) < 100) {
next
}
if(overlap_shorter_fraction < 0.75) {
next
}
if(rb_i == rb_j) {
next
}
final_list[[cnt]] <- data.frame(pmid = pmid_tmp,
row1 = rows_for_pmid[i],
row2 = rows_for_pmid[j],
overlap_length = length(inter_set),
set1_count = length(rco_i),
set2_count = length(rco_j),
overlap_longer_fraction = overlap_longer_fraction,
overlap_shorter_fraction = overlap_shorter_fraction,
set1_resp_behav = rb_i,
set2_resp_behav = rb_j
)
cnt <- cnt + 1
}
}
}
head(final_list, 10)
uniqIDs <- unique(df2$uniq_obs_id)
# way too big!
final_list <- vector(mode = "list", length = length(uniqIDs)*(length(uniqIDs) - 1)/2)
cnt <- 1
for(pmid in pmids) {
rows_for_pmid <- unique(df2$uniq_obs_id[df2$publication_reference == pmid])
for(i in 1:length(rows_for_pmid)) {
rco_i <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[i]]
rb_i <- df2$response_behavior[df2$uniq_obs_id == rows_for_pmid[i]][1]
for(j in min(i + 1, length(rows_for_pmid)):length(rows_for_pmid)) {
if(i == j) {
next
}
rco_j <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[j]]
rb_j <- df2$response_behavior[df2$uniq_obs_id == rows_for_pmid[j]][1]
inter_set <- intersect(rco_i, rco_j)
overlap_longer_fraction <- length(inter_set)/max(length(rco_i), length(rco_j))
overlap_shorter_fraction <- length(inter_set)/min(length(rco_i), length(rco_j))
if(length(inter_set) < 100) {
next
}
if(overlap_shorter_fraction < 0.75) {
next
}
if(rb_i == rb_j) {
next
}
final_list[[cnt]] <- data.frame(pmid = pmid,
row1 = rows_for_pmid[i],
row2 = rows_for_pmid[j],
overlap_length = length(inter_set),
set1_count = length(rco_i),
set2_count = length(rco_j),
overlap_longer_fraction = overlap_longer_fraction,
overlap_shorter_fraction = overlap_shorter_fraction,
set1_resp_behav = rb_i,
set2_resp_behav = rb_j
)
cnt <- cnt + 1
}
}
}
head(final_list, 10)
writeLines(final_list)
write.table(final_list)
for(i in 1:5) {
write.table(final_list[i, ])
}
ft <- rbindlist(final_list)
dim(ft)
ft
write.table(ft)
write.table(ft, sep = "\t")
ft
check_overlap <- function(df2, min_intersection, min_overlap_fraction, max_hits) {
final_list <- vector(mode = "list", max_hits)
cnt <- 1
for(pmid in pmids) {
rows_for_pmid <- unique(df2$uniq_obs_id[df2$publication_reference == pmid])
for(i in 1:length(rows_for_pmid)) {
rco_i <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[i]]
rb_i <- df2$response_behavior[df2$uniq_obs_id == rows_for_pmid[i]][1]
for(j in min(i + 1, length(rows_for_pmid)):length(rows_for_pmid)) {
if(i == j) {
next
}
rco_j <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[j]]
rb_j <- df2$response_behavior[df2$uniq_obs_id == rows_for_pmid[j]][1]
inter_set <- intersect(rco_i, rco_j)
overlap_longer_fraction <- length(inter_set)/max(length(rco_i), length(rco_j))
overlap_shorter_fraction <- length(inter_set)/min(length(rco_i), length(rco_j))
if(length(inter_set) < min_intersection) {
next
}
if(overlap_shorter_fraction < min_overlap_fraction) {
next
}
if(rb_i == rb_j) {
next
}
final_list[[cnt]] <- data.frame(pmid = pmid,
row1 = rows_for_pmid[i],
row2 = rows_for_pmid[j],
overlap_length = length(inter_set),
set1_count = length(rco_i),
set2_count = length(rco_j),
overlap_longer_fraction = overlap_longer_fraction,
overlap_shorter_fraction = overlap_shorter_fraction,
set1_resp_behav = rb_i,
set2_resp_behav = rb_j
)
cnt <- cnt + 1
if(cnt > max_hits) {
return(NULL)
}
}
}
}
ft <- rbindlist(final_list)
}
ft <- check_overlap(df2, 100, 0.75, 100)
ft
ft <- check_overlap(df2, min_intersection = 100, min_overlap_fraction = 0.75, max_hits= 100)
ft
ft <- check_overlap(df2, min_intersection = 50, min_overlap_fraction = 0.75, max_hits= 100)
ft
ft <- check_overlap(df2, min_intersection = 25, min_overlap_fraction = 0.75, max_hits = 100)
ft
check_overlap <- function(df2, min_intersection, min_overlap_fraction, require_different_behaviors, max_hits) {
final_list <- vector(mode = "list", max_hits)
cnt <- 1
for(pmid in pmids) {
rows_for_pmid <- unique(df2$uniq_obs_id[df2$publication_reference == pmid])
for(i in 1:length(rows_for_pmid)) {
rco_i <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[i]]
rb_i <- df2$response_behavior[df2$uniq_obs_id == rows_for_pmid[i]][1]
for(j in min(i + 1, length(rows_for_pmid)):length(rows_for_pmid)) {
if(i == j) {
next
}
rco_j <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[j]]
rb_j <- df2$response_behavior[df2$uniq_obs_id == rows_for_pmid[j]][1]
inter_set <- intersect(rco_i, rco_j)
overlap_longer_fraction <- length(inter_set)/max(length(rco_i), length(rco_j))
overlap_shorter_fraction <- length(inter_set)/min(length(rco_i), length(rco_j))
if(length(inter_set) < min_intersection) {
next
}
if(overlap_shorter_fraction < min_overlap_fraction) {
next
}
if(require_different_behaviors && (rb_i == rb_j)) {
next
}
final_list[[cnt]] <- data.frame(pmid = pmid,
row1 = rows_for_pmid[i],
row2 = rows_for_pmid[j],
overlap_length = length(inter_set),
set1_count = length(rco_i),
set2_count = length(rco_j),
overlap_longer_fraction = overlap_longer_fraction,
overlap_shorter_fraction = overlap_shorter_fraction,
set1_resp_behav = rb_i,
set2_resp_behav = rb_j
)
cnt <- cnt + 1
if(cnt > max_hits) {
return(NULL)
}
}
}
}
ft <- rbindlist(final_list)
}
ft <- check_overlap(df2, min_intersection = 25, min_overlap_fraction = 0.75, require_different_behaviors = TRUE, max_hits = 100)
ft
check_response_components_overlap <- function(df2, min_intersection, min_overlap_fraction, require_different_behaviors, max_hits) {
final_list <- vector(mode = "list", max_hits)
cnt <- 1
for(pmid in pmids) {
rows_for_pmid <- unique(df2$uniq_obs_id[df2$publication_reference == pmid])
for(i in 1:length(rows_for_pmid)) {
rco_i <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[i]]
rb_i <- df2$response_behavior[df2$uniq_obs_id == rows_for_pmid[i]][1]
for(j in min(i + 1, length(rows_for_pmid)):length(rows_for_pmid)) {
if(i == j) {
next
}
rco_j <- df2$response_component_original[df2$uniq_obs_id == rows_for_pmid[j]]
rb_j <- df2$response_behavior[df2$uniq_obs_id == rows_for_pmid[j]][1]
inter_set <- intersect(rco_i, rco_j)
overlap_longer_fraction <- length(inter_set)/max(length(rco_i), length(rco_j))
overlap_shorter_fraction <- length(inter_set)/min(length(rco_i), length(rco_j))
if(length(inter_set) < min_intersection) {
next
}
if(overlap_shorter_fraction < min_overlap_fraction) {
next
}
if(require_different_behaviors && (rb_i == rb_j)) {
next
}
final_list[[cnt]] <- data.frame(pmid = pmid,
row1 = rows_for_pmid[i],
row2 = rows_for_pmid[j],
overlap_length = length(inter_set),
set1_count = length(rco_i),
set2_count = length(rco_j),
overlap_longer_fraction = overlap_longer_fraction,
overlap_shorter_fraction = overlap_shorter_fraction,
set1_resp_behav = rb_i,
set2_resp_behav = rb_j
)
cnt <- cnt + 1
if(cnt > max_hits) {
return(NULL)
}
}
}
}
ft <- rbindlist(final_list)
}
# check for lists of response components within one PMID that have a large overlap with one another.
# This is intended to catch the case were one set was accidently appended to another.
# (It happens!)
ft <- check_response_components_overlap(df2, min_intersection = 10, min_overlap_fraction = 0.75, require_different_behaviors = TRUE, max_hits = 100)
ft
